appId: com.eclosion.desktop
productName: Eclosion
copyright: Copyright (c) 2026

# Build directories
directories:
  output: release
  buildResources: assets

# Files to include in the app
files:
  - dist/**/*
  - "!node_modules/**/*"

# Extra resources (not in asar)
# Note: macOS uses architecture-specific backend directories (set up by CI)
# Windows/Linux use a single 'backend' directory
extraResources:
  # Frontend build
  - from: ../frontend/dist
    to: frontend
    filter:
      - "**/*"
  # Python backend executable (Windows/Linux only - macOS uses arch-specific dirs)
  - from: pyinstaller/dist/eclosion-backend
    to: backend
    filter:
      - "**/*"
  # Tray icons (needed at runtime for menu bar)
  - from: assets/tray
    to: assets/tray
    filter:
      - "**/*"

# Publish to GitHub Releases
publish:
  provider: github
  owner: 312-dev
  repo: eclosion
  releaseType: release

# Protocol handler (deep links)
protocols:
  - name: Eclosion
    schemes:
      - eclosion

# Pre-sign hook for Python.framework (fixes ambiguous bundle format)
afterPack: afterPack.js

# macOS configuration
mac:
  category: public.app-category.finance
  target:
    - target: dmg
      arch: universal
    - target: zip
      arch: universal
  icon: assets/icon.icns
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: entitlements.mac.plist
  entitlementsInherit: entitlements.mac.plist
  darkModeSupport: true
  # afterPack.js pre-signs backend with --no-strict (required for PyInstaller)
  # signIgnore prevents electron-builder from re-signing and breaking those signatures
  # NOTE: These are regex patterns, not glob patterns
  signIgnore:
    - ".*backend.*"
    - ".*Python\\.framework.*"
  # macOS universal binary includes both ARM64 and x64 backends
  # The app selects the correct one at runtime based on process.arch
  extraResources:
    - from: ../frontend/dist
      to: frontend
      filter:
        - "**/*"
    - from: pyinstaller/dist/backend-arm64
      to: backend-arm64
      filter:
        - "**/*"
    - from: pyinstaller/dist/backend-x64
      to: backend-x64
      filter:
        - "**/*"
    - from: assets/tray
      to: assets/tray
      filter:
        - "**/*"

# macOS code signing
afterSign: notarize.js

# DMG configuration
dmg:
  sign: false
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications
  window:
    width: 540
    height: 380

# Windows configuration
win:
  target:
    - target: nsis
      arch:
        - x64
  icon: assets/icon.ico

# NSIS installer configuration
nsis:
  oneClick: true
  perMachine: false
  deleteAppDataOnUninstall: false
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: Eclosion
  installerIcon: assets/icon.ico
  uninstallerIcon: assets/icon.ico
  differentialPackage: true
  # Include custom NSIS scripts for uninstall prompts
  include: installer/custom.nsh

# Linux configuration
# AppImage-only for faster builds - works on all distros without package manager integration
linux:
  target:
    - target: AppImage
      arch:
        - x64
        - arm64
  category: Finance
  icon: assets/icon.png
  maintainer: grayson@eclosion.app
  vendor: Eclosion
  synopsis: Recurring expense tracker for Monarch Money
  description: A self-hosted toolkit that expands what's possible with Monarch Money

# AppImage configuration
appImage:
  artifactName: ${productName}-${version}-${arch}.${ext}

# Auto-update configuration
# electron-updater will look for these manifest files
# latest.yml (Windows), latest-mac.yml (macOS), latest-linux.yml (Linux)
